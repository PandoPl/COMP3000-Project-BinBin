<!-- backend/templates/index.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BinBin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>
  <body>
    <h1>BinBin Dashboard</h1>

    <section>
      <h2>Bins</h2>
      <div id="bins"></div>
    </section>

    <section>
      <h2>Recent Events</h2>
      <div id="events"></div>
    </section>

    <script>
      async function loadBins() {
        const res = await fetch("/api/bins");
        const data = await res.json();
        const div = document.getElementById("bins");
        if (data.length === 0) {
          div.innerHTML = "<p>No bins configured yet.</p>";
          return;
        }
        let html = "<ul>";
        for (const b of data) {
          html += `<li><strong>${b.name}</strong> (${b.bin_type}) â€“ threshold: ${b.full_threshold_cm} cm</li>`;
        }
        html += "</ul>";
        div.innerHTML = html;
      }

      async function loadEvents() {
        const res = await fetch("/api/events");
        const data = await res.json();
        const div = document.getElementById("events");
        if (data.length === 0) {
          div.innerHTML = "<p>No events yet.</p>";
          return;
        }
        let html = "<table><tr><th>Time</th><th>Bin</th><th>Type</th><th>Distance (cm)</th><th>Label</th><th>Conf.</th></tr>";
        for (const e of data) {
          html += `<tr>
            <td>${e.timestamp}</td>
            <td>${e.bin_id}</td>
            <td>${e.event_type || ""}</td>
            <td>${e.distance_cm ?? ""}</td>
            <td>${e.label || ""}</td>
            <td>${e.confidence != null ? e.confidence.toFixed(2) : ""}</td>
          </tr>`;
        }
        html += "</table>";
        div.innerHTML = html;
      }

      loadBins();
      loadEvents();
      setInterval(loadEvents, 5000); // refresh events every 5s
    </script>
  </body>
</html>
